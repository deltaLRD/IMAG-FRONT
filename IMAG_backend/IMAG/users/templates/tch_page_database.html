{% extends 'base_tch.html' %}
{% block style %}
   .vis_button{
    display:inline;
    }
   li{
    line-height:40px;
    display:flex;
    justify-content:space-between;
    }
    .atitle{
    font-size:40px;
    font-family:"微软雅黑";
    padding:20px 0px;
    }
    .li_name{
    font-size:10px;
    font-family:"微软雅黑";
    }
    .add_title{
    display:flex;
    justify-content:space-between;
    }
{% endblock %}
{% block center %}










    <div class="media">
        <div class="media-left media-middle">
            <a href="#">
                <img class="media-object" src="../../static/avatar/{{ tch_info.account }}.jpg"
                     alt="{{ tch_info.account }}" width="180px" height="" id="imag_id">
            </a>
        </div>
        <div class="media-body">

            <h3 class="media-heading">{{ tch_info.Eng_name }}</h3>

            <p><a src="http://www.njust.edu.cn/">Nanjing University of Science and Technology</a></p>


            <p>Email : {{ tch_info.email }}</p>

            <p id="profile">{{ tch_info.profile }}<a onclick="tran();">[中文版]</a></p>
            <button type="button"  id="save_all" class="btn btn-info" onclick="save_all()">保存</button>
        </div>
    </div>

    <hr>

 <div class="add_title">
        <div class="atitle" id="title_jn">论文</div>
        </div>
    <ul id="jn_id">
            {% for row in jn_info_dict %}
            <li class="jn_li" id="{{ row.id }}" value="{{ row['author'] }}">
                <div class="li_name">{{ row.name}}
            {% for auth in row['author'] %}
                {{ auth }}
            {% endfor %}
                </div>
            <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
            </div>
            </li>
           {% endfor %}
    </ul>
     <div class="add_title">
         <div class="atitle" id="title_con">会议</div>
     </div>
    <ul id="conf_id">
        {% for row  in conf_info_dict %}
            <li class="conf_li" id="{{ row.id }}" value="{{ row['author'] }}">
                <div class="li_name">{{ row.name }}
                {% for auth in row['author'] %}
                    {{ auth }}
                {% endfor %}
                </div>
                <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                </div>
            </li>
        {% endfor %}
    </ul>
     <div class="add_title">
    <div class="atitle" id="title_patent">专利</div>
     </div>
    <ul id="patent_id">
        {% for row in patent_info %}
            <li class="patent_li" id="{{ row.id }}" >
                <div class="li_name">{{ row.name}} </div>
                <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                </div>
            </li>
        {% endfor %}
    </ul>
     <div class="add_title">
    <div class="atitle" id="title_honor">荣誉</div>
    </div>
    <ul id="honor_id">
        {% for row in honor_info %}
            <li class="honor_li" id="{{ row.id }}" >
                 <div class="li_name">{{ row.name}} </div>
                <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                </div>
            </li>
        {% endfor %}
    </ul>
     <div class="add_title">
    <div class="atitle" id="title_pro">项目</div>
     </div>
    <ul id="prog_id">
        {% for row in prog_info %}
            <li class="prog_li" id="{{ row.id }}" >
           <div class="li_name">{{ row.name}} </div>
            <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
            </div>
            </li>
        {% endfor %}
    </ul>
     <div class="add_title">
        <div class="atitle" id="title_course">课程</div>
     </div>
            <ul id="course_id">
    {% for row in course_info %}
                <li class="course_li" id="{{ row.id }}" >
                     <div class="li_name">{{ row.name}} </div>
                    <div class="vis_button">
                    <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                    </div>
                </li>
            {% endfor %}
    </ul>
     <div class="add_title">
    <div class="atitle" id="title_comp">竞赛</div>
     </div>
    <ul id="comp_id">
        {% for row in comp_info %}
            <li class="comp_li" id="{{ row.id }}" >
                 <div class="li_name">{{ row.name}} </div>
                <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                </div>
            </li>
        {% endfor %}
    </ul>
     <div class="add_title">
    <div class="atitle" id="title_mono">专著</div>
     </div>
    <ul id="mono_id">
        {% for row in mono_info %}
            <li class="mono_li" id="{{ row.id }}" >
               <div class="li_name">{{ row.name}} </div>
                <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                </div>
            </li>

        {% endfor %}
    </ul>
    <div class="add_title">
    <div class="atitle" id="title_soft">软著</div>
    </div>
    <ul id="soft_id">
        {% for row in soft_info %}
            <li class="soft_li" id="{{ row.id }}">
                <div class="li_name">{{ row.name}} </div>
                <div class="vis_button">
                <button class="layui-btn layui-btn-sm" onclick="dele(this)"><i class="layui-icon">&#xe640;</i></button>
                </div>
            </li>
        {% endfor %}
    </ul>

    {{ others_info }}



 <script>
    function save_all(){
         const conf_list=document.getElementsByClassName("conf_li")
         const jn_list=document.getElementsByClassName("jn_li")
         const prog_list=document.getElementsByClassName("prog_li")
         const soft_list=document.getElementsByClassName("soft_li")
         const course_list=document.getElementsByClassName("course_li")
         const mono_list=document.getElementsByClassName("mono_li")
         const honor_list=document.getElementsByClassName("honor_li")
         const patent_list=document.getElementsByClassName("patent_li")
         const comp_list=document.getElementsByClassName("comp_li")
         const conf = [];
         const jn=[];
         const prog=[];
         const soft=[];
         const course=[];
         const mono=[];
         const honor=[];
         const patent=[];
         const comp=[];
         for(let i=0; i<conf_list.length; i++){
             let id=conf_list[i].id.toString()
             let list=conf_list[i].getAttribute('value')
             conf.push({id,list})
         }
         for(let i=0; i<jn_list.length; i++){
             let id=jn_list[i].id.toString()
             let list=jn_list[i].getAttribute('value')
             jn.push({id,list})
         }
         for(let i=0;i<prog_list.length;i++){
             prog.push(prog_list[i].id)
         }
         for(let i=0;i<soft_list.length;i++){
             soft.push(soft_list[i].id)
         }
         for(let i=0;i<course_list.length;i++){
             course.push(course_list[i].id)
         }
         for(let i=0;i<mono_list.length;i++){
             mono.push(mono_list[i].id)
         }
         for(let i=0;i<honor_list.length;i++){
             honor.push(honor_list[i].id)
         }
         for(let i=0;i<patent_list.length;i++){
             patent.push(patent_list[i].id)
         }
         for(let i=0;i<comp_list.length;i++){
             comp.push(comp_list[i].id)
         }
         const data_json={
             account:Serve1.account,
             conf:conf,
             jn:jn,
             prog:prog,
             soft:soft,
             course:course,
             mono:mono,
             honor:honor,
             patent:patent,
             comp:comp,
         }
         console.log(data_json)
         $.ajax({
            type: 'POST',
            url: "/users/user_database",
            data: JSON.stringify(data_json),
            contentType: 'application/json; charset=UTF-8',
            dataType: 'json',
             success: function(data) {
                 layer.msg(data['message'], {
                    icon: 1,
                    time: 1000,
                    offset: 't',
                })
            }})
    }








 function dele(e) {
      if($(e).parent().parent().prev().attr('class')==="atitle") $(e).parent().parent().prev().remove()
      $(e).parent().parent().remove()

 }


 var Serve1={
     profile_eng:{{ tch_info.profile|tojson }},
     profile_ch:{{ tch_info.profile_c|tojson }},
     account:{{ tch_info.account|tojson }}
 }
 tranx=function (){
      pro=document.getElementById("profile")
      temp=document.createElement("a")
      temp.innerText="[中文版]"
     pro.innerText=Serve1.profile_eng
     temp.onclick=tran
     pro.appendChild(temp)
 }
  tran=function (){
        pro=document.getElementById("profile")
        temp=document.createElement("a")
        temp.innerText="[English Version]"
        temp.onclick=tranx
        pro.innerText=Serve1.profile_ch
        pro.appendChild(temp)
       }

</script>
{% endblock %}
